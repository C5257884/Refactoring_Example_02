# Refactoring_Example_01
GTD Splitting in Invoice printing

Файлы в хранилище:

**FORM_GTD_SPLITTING** - исходный код, который подвергался рефакторингу
**LCL_INVOICE_ROW_PROCESSOR** - локальный класс, в который "убрана" логика из FORM gtd_splitting
**Include ZJ_3RV_CORRINV_A_TC01** - тестовые классы

Описание:

Это пример рефакторинга "legacy code".
Исходная программа содержала **FORM gtd_splitting**, которая была написана, на мой взгляд, "не очень".
Юнит-тесты для нее можно написать только DANGEROUS - т.е. с предварительной записью тестового блока данных в БД, с последующим его удалением.
Мне кажется, что в данном случае более уместно переписать код, изолировав "внешние зависимости" (вызовы сторонних ФМ, SELECT-ы из БД) в отдельных методах, чтобы при тестировании их можно было заменить фиктивными методами из класса наследника, для получения нужных данных из ECATT TDC.

Это, конечно, не единственный шаблон, как это может быть написано, можно предложить еще несколько подходов, для того, чтобы код стал "testable":

1. "Внешние зависимости" "заковычить" 
    ◾TEST-SEAM - END-TEST-SEAM
    ◾TEST-INJECTION - END-TEST-INJECTION
2. "Внешние зависимости" - убрать в отдельный класс, чтобы при тестировании (или дальнейшей доработки) можно было использоввать шаблон "DEPENDENCY INJECTION"



